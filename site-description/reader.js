'use strict';

var ArgumentNullException = require('../exception').ArgumentNullException;
var ArgumentInvalidException = require('../exception').ArgumentInvalidException;

var _require = require('lodash/lang');

var isObject = _require.isObject;
var isFunction = _require.isFunction;
var isArray = _require.isArray;
var isEqual = _require.isEqual;
var clone = _require.clone;

var contains = require('lodash/collection/contains');
var intersection = require('lodash/array/intersection');
var keys = require('lodash/object/keys');

//Module page.
var siteDescriptionStructure = void 0,
    siteDescriptionParams = void 0,
    isProcess = false;

//Get the site process
var getSite = function getSite() {
  isProcess = true;
  if (!isFunction(siteDescriptionStructure)) {
    console.warn('You are trying to call getSite before it was correctly initialized...');
  }
  return siteDescriptionStructure(siteDescriptionParams);
};

//Define the application site description.
//The siteDescription must be a function which return an object with the following structure:
// `{headers: [{name: "NameOfTheModule", url: "#nameOftheModule/:param, roles:['CHIEF', 'MASTER']", headers: [[{name: "NameOfTheModule", url: "#nameOftheModule/:param, roles:['CHIEF', 'MASTER']", headers: []}]]}]}`
var defineSite = function defineSite(siteDescription) {
  if (!isObject(siteDescription)) {
    throw new ArgumentNullException('SiteDescription must be an object', siteDescription);
  }
  if (!isObject(siteDescription.params)) {
    throw new ArgumentNullException('SiteDescription.params must be an object', siteDescription);
  }
  if (!isFunction(siteDescription.value)) {
    throw new ArgumentNullException('SiteDescription.value must be a function', siteDescription);
  }
  siteDescriptionParams = siteDescription.params || {};
  siteDescriptionStructure = siteDescription.value;
  return getSite();
};

//param must be a {name: 'paramName', value: 'paramValue'} object.
var defineParam = function defineParamSiteDescriptionHelper(param) {
  if (param === undefined) {
    throw new ArgumentNullException('You cannot set an undefined param.', param);
  }
  //console.log("Debug", param.name, siteDescriptionParams,siteDescriptionParams['codePays']);
  if (siteDescriptionParams[param.name] === undefined) {
    throw new ArgumentNullException('The parameter you try to define has not been anticipated by the siteDescription', {
      param: param,
      siteParams: siteDescriptionParams
    });
  }
  if (siteDescriptionParams[param.name].value === param.value && isEqual(siteDescriptionParams[param.name].title, param.title)) {
    console.info('No changes on param', param);
    return false;
  }
  siteDescriptionParams[param.name] = {
    value: param.value,
    title: param.title,
    isDefine: true
  };
  isProcess = false;
  return true;
};

//Check if the params is define in the params list.
var checkParams = function checkParams(paramsArray) {
  if (typeof paramsArray === 'undefined') {
    return true;
  }
  if (isArray(paramsArray)) {
    throw new ArgumentInvalidException('The paramsArray must be an array');
  }
  if (intersection(keys(siteDescriptionParams), paramsArray).length !== paramsArray.length) {
    return false;
  }
  for (var prop in siteDescriptionParams) {
    if (contains(paramsArray, prop) && !siteDescriptionParams[prop].isDefine) {
      return false;
    }
  }
  return true;
};

var siteDescriptionHelper = {
  defineSite: defineSite,
  defineParam: defineParam,
  getSite: getSite,
  getParams: function getParams() {
    return clone(siteDescriptionParams);
  },
  checkParams: checkParams,
  isProcessed: function isProcessed() {
    return isProcess;
  }
};

module.exports = siteDescriptionHelper;
//# sourceMappingURL=data:application/json;base64,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QkFBTCxDQUFiLEVBQTBDLFdBQTFDLEVBQXVELE1BQXZELEtBQWtFLFlBQVksTUFBbEYsRUFBMEY7QUFDeEYsV0FBTyxLQUFQO0FBQ0Q7QUFDRCxPQUFLLElBQUksSUFBVCxJQUFpQixxQkFBakIsRUFBd0M7QUFDdEMsUUFBSSxTQUFTLFdBQVQsRUFBc0IsSUFBdEIsS0FBK0IsQ0FBQyxzQkFBc0IsSUFBdEIsRUFBNEIsUUFBaEUsRUFBMEU7QUFDeEUsYUFBTyxLQUFQO0FBQ0Q7QUFDRjtBQUNELFNBQU8sSUFBUDtBQUNELENBaEJEOztBQWtCQSxJQUFJLHdCQUF3QjtBQUMxQixjQUFZLFVBRGM7QUFFMUIsZUFBYSxXQUZhO0FBRzFCLFdBQVMsT0FIaUI7QUFJMUIsYUFBVyxxQkFBWTtBQUNyQixXQUFPLE1BQU0scUJBQU4sQ0FBUDtBQUNELEdBTnlCO0FBTzFCLGVBQWEsV0FQYTtBQVExQixlQUFhLFNBQVMsV0FBVCxHQUF1QjtBQUNsQyxXQUFPLFNBQVA7QUFDRDtBQVZ5QixDQUE1Qjs7QUFhQSxPQUFPLE9BQVAsR0FBaUIscUJBQWpCIiwiZmlsZSI6InByb2Nlc3Nvci5qcyIsInNvdXJjZXNDb250ZW50IjpbImxldCBBcmd1bWVudE51bGxFeGNlcHRpb24gPSByZXF1aXJlKCcuLi9leGNlcHRpb24nKS5Bcmd1bWVudE51bGxFeGNlcHRpb247XHJcbmxldCBBcmd1bWVudEludmFsaWRFeGNlcHRpb24gPSByZXF1aXJlKCcuLi9leGNlcHRpb24nKS5Bcmd1bWVudEludmFsaWRFeGNlcHRpb247XHJcbmxldCB7aXNPYmplY3QsIGlzRnVuY3Rpb24sIGlzQXJyYXksIGlzRXF1YWwsIGNsb25lfSA9IHJlcXVpcmUoJ2xvZGFzaC9sYW5nJyk7XHJcbmxldCBjb250YWlucyA9IHJlcXVpcmUoJ2xvZGFzaC9jb2xsZWN0aW9uL2NvbnRhaW5zJyk7XHJcbmxldCBpbnRlcnNlY3Rpb24gPSByZXF1aXJlKCdsb2Rhc2gvYXJyYXkvaW50ZXJzZWN0aW9uJyk7XHJcbmxldCBrZXlzID0gcmVxdWlyZSgnbG9kYXNoL29iamVjdC9rZXlzJyk7XHJcblxyXG4vL01vZHVsZSBwYWdlLlxyXG5sZXQgc2l0ZURlc2NyaXB0aW9uU3RydWN0dXJlLFxyXG4gIHNpdGVEZXNjcmlwdGlvblBhcmFtcyxcclxuICBpc1Byb2Nlc3MgPSBmYWxzZTtcclxuXHJcbiAgLy9HZXQgdGhlIHNpdGUgcHJvY2Vzc1xyXG4gIHZhciBnZXRTaXRlID0gZnVuY3Rpb24gZ2V0U2l0ZSgpIHtcclxuICAgIGlzUHJvY2VzcyA9IHRydWU7XHJcbiAgICBpZighaXNGdW5jdGlvbihzaXRlRGVzY3JpcHRpb25TdHJ1Y3R1cmUpKXtcclxuICAgICAgY29uc29sZS53YXJuKCdZb3UgYXJlIHRyeWluZyB0byBjYWxsIGdldFNpdGUgYmVmb3JlIGl0IHdhcyBjb3JyZWN0bHkgaW5pdGlhbGl6ZWQuLi4nKTtcclxuICAgIH1cclxuICAgIHJldHVybiBzaXRlRGVzY3JpcHRpb25TdHJ1Y3R1cmUoc2l0ZURlc2NyaXB0aW9uUGFyYW1zKTtcclxuICB9O1xyXG5cclxuLy9EZWZpbmUgdGhlIGFwcGxpY2F0aW9uIHNpdGUgZGVzY3JpcHRpb24uXHJcbi8vVGhlIHNpdGVEZXNjcmlwdGlvbiBtdXN0IGJlIGEgZnVuY3Rpb24gd2hpY2ggcmV0dXJuIGFuIG9iamVjdCB3aXRoIHRoZSBmb2xsb3dpbmcgc3RydWN0dXJlOlxyXG4vLyBge2hlYWRlcnM6IFt7bmFtZTogXCJOYW1lT2ZUaGVNb2R1bGVcIiwgdXJsOiBcIiNuYW1lT2Z0aGVNb2R1bGUvOnBhcmFtLCByb2xlczpbJ0NISUVGJywgJ01BU1RFUiddXCIsIGhlYWRlcnM6IFtbe25hbWU6IFwiTmFtZU9mVGhlTW9kdWxlXCIsIHVybDogXCIjbmFtZU9mdGhlTW9kdWxlLzpwYXJhbSwgcm9sZXM6WydDSElFRicsICdNQVNURVInXVwiLCBoZWFkZXJzOiBbXX1dXX1dfWBcclxudmFyIGRlZmluZVNpdGUgPSBmdW5jdGlvbiBkZWZpbmVTaXRlKHNpdGVEZXNjcmlwdGlvbikge1xyXG4gIGlmICghaXNPYmplY3Qoc2l0ZURlc2NyaXB0aW9uKSkge1xyXG4gICAgdGhyb3cgbmV3IEFyZ3VtZW50TnVsbEV4Y2VwdGlvbignU2l0ZURlc2NyaXB0aW9uIG11c3QgYmUgYW4gb2JqZWN0Jywgc2l0ZURlc2NyaXB0aW9uKTtcclxuICB9XHJcbiAgaWYgKCFpc09iamVjdChzaXRlRGVzY3JpcHRpb24ucGFyYW1zKSkge1xyXG4gICAgdGhyb3cgbmV3IEFyZ3VtZW50TnVsbEV4Y2VwdGlvbignU2l0ZURlc2NyaXB0aW9uLnBhcmFtcyBtdXN0IGJlIGFuIG9iamVjdCcsIHNpdGVEZXNjcmlwdGlvbik7XHJcbiAgfVxyXG4gIGlmICghaXNGdW5jdGlvbihzaXRlRGVzY3JpcHRpb24udmFsdWUpKSB7XHJcbiAgICB0aHJvdyBuZXcgQXJndW1lbnROdWxsRXhjZXB0aW9uKCdTaXRlRGVzY3JpcHRpb24udmFsdWUgbXVzdCBiZSBhIGZ1bmN0aW9uJywgc2l0ZURlc2NyaXB0aW9uKTtcclxuICB9XHJcbiAgc2l0ZURlc2NyaXB0aW9uUGFyYW1zID0gc2l0ZURlc2NyaXB0aW9uLnBhcmFtcyB8fCB7fTtcclxuICBzaXRlRGVzY3JpcHRpb25TdHJ1Y3R1cmUgPSBzaXRlRGVzY3JpcHRpb24udmFsdWU7XHJcbiAgcmV0dXJuIGdldFNpdGUoKTtcclxufTtcclxuXHJcbi8vcGFyYW0gbXVzdCBiZSBhIHtuYW1lOiAncGFyYW1OYW1lJywgdmFsdWU6ICdwYXJhbVZhbHVlJ30gb2JqZWN0LlxyXG5sZXQgZGVmaW5lUGFyYW0gPSBmdW5jdGlvbiBkZWZpbmVQYXJhbVNpdGVEZXNjcmlwdGlvbkhlbHBlcihwYXJhbSkge1xyXG4gIGlmIChwYXJhbSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICB0aHJvdyBuZXcgQXJndW1lbnROdWxsRXhjZXB0aW9uKCdZb3UgY2Fubm90IHNldCBhbiB1bmRlZmluZWQgcGFyYW0uJywgcGFyYW0pO1xyXG4gIH1cclxuICAvL2NvbnNvbGUubG9nKFwiRGVidWdcIiwgcGFyYW0ubmFtZSwgc2l0ZURlc2NyaXB0aW9uUGFyYW1zLHNpdGVEZXNjcmlwdGlvblBhcmFtc1snY29kZVBheXMnXSk7XHJcbiAgaWYgKHNpdGVEZXNjcmlwdGlvblBhcmFtc1twYXJhbS5uYW1lXSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICB0aHJvdyBuZXcgQXJndW1lbnROdWxsRXhjZXB0aW9uKCdUaGUgcGFyYW1ldGVyIHlvdSB0cnkgdG8gZGVmaW5lIGhhcyBub3QgYmVlbiBhbnRpY2lwYXRlZCBieSB0aGUgc2l0ZURlc2NyaXB0aW9uJywge1xyXG4gICAgICBwYXJhbTogcGFyYW0sXHJcbiAgICAgIHNpdGVQYXJhbXM6IHNpdGVEZXNjcmlwdGlvblBhcmFtc1xyXG4gICAgfSk7XHJcbiAgfVxyXG4gIGlmIChzaXRlRGVzY3JpcHRpb25QYXJhbXNbcGFyYW0ubmFtZV0udmFsdWUgPT09IHBhcmFtLnZhbHVlICYmIGlzRXF1YWwoc2l0ZURlc2NyaXB0aW9uUGFyYW1zW3BhcmFtLm5hbWVdLnRpdGxlLCBwYXJhbS50aXRsZSkpIHtcclxuICAgIGNvbnNvbGUuaW5mbygnTm8gY2hhbmdlcyBvbiBwYXJhbScsIHBhcmFtKTtcclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcbiAgc2l0ZURlc2NyaXB0aW9uUGFyYW1zW3BhcmFtLm5hbWVdID0ge1xyXG4gICAgdmFsdWU6IHBhcmFtLnZhbHVlLFxyXG4gICAgdGl0bGU6IHBhcmFtLnRpdGxlLFxyXG4gICAgaXNEZWZpbmU6IHRydWVcclxuICB9O1xyXG4gIGlzUHJvY2VzcyA9IGZhbHNlO1xyXG4gIHJldHVybiB0cnVlO1xyXG59O1xyXG5cclxuLy9DaGVjayBpZiB0aGUgcGFyYW1zIGlzIGRlZmluZSBpbiB0aGUgcGFyYW1zIGxpc3QuXHJcbnZhciBjaGVja1BhcmFtcyA9IGZ1bmN0aW9uIGNoZWNrUGFyYW1zKHBhcmFtc0FycmF5KSB7XHJcbiAgaWYgKHR5cGVvZiBwYXJhbXNBcnJheSA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgIHJldHVybiB0cnVlO1xyXG4gIH1cclxuICBpZiAoaXNBcnJheShwYXJhbXNBcnJheSkpIHtcclxuICAgIHRocm93IG5ldyBBcmd1bWVudEludmFsaWRFeGNlcHRpb24oJ1RoZSBwYXJhbXNBcnJheSBtdXN0IGJlIGFuIGFycmF5Jyk7XHJcbiAgfVxyXG4gIGlmIChpbnRlcnNlY3Rpb24oa2V5cyhzaXRlRGVzY3JpcHRpb25QYXJhbXMpLCBwYXJhbXNBcnJheSkubGVuZ3RoICE9PSBwYXJhbXNBcnJheS5sZW5ndGgpIHtcclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcbiAgZm9yICh2YXIgcHJvcCBpbiBzaXRlRGVzY3JpcHRpb25QYXJhbXMpIHtcclxuICAgIGlmIChjb250YWlucyhwYXJhbXNBcnJheSwgcHJvcCkgJiYgIXNpdGVEZXNjcmlwdGlvblBhcmFtc1twcm9wXS5pc0RlZmluZSkge1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgfVxyXG4gIHJldHVybiB0cnVlO1xyXG59O1xyXG5cclxudmFyIHNpdGVEZXNjcmlwdGlvbkhlbHBlciA9IHtcclxuICBkZWZpbmVTaXRlOiBkZWZpbmVTaXRlLFxyXG4gIGRlZmluZVBhcmFtOiBkZWZpbmVQYXJhbSxcclxuICBnZXRTaXRlOiBnZXRTaXRlLFxyXG4gIGdldFBhcmFtczogZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIGNsb25lKHNpdGVEZXNjcmlwdGlvblBhcmFtcyk7XHJcbiAgfSxcclxuICBjaGVja1BhcmFtczogY2hlY2tQYXJhbXMsXHJcbiAgaXNQcm9jZXNzZWQ6IGZ1bmN0aW9uIGlzUHJvY2Vzc2VkKCkge1xyXG4gICAgcmV0dXJuIGlzUHJvY2VzcztcclxuICB9XHJcbiAgfTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gc2l0ZURlc2NyaXB0aW9uSGVscGVyO1xyXG4iXX0=